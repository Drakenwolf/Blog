{"version":3,"names":[],"mappings":"","sources":["main.js"],"sourcesContent":["/**\r\n * Main JS file for Zvikov\r\n */\r\n\r\n// Parse the URL parameter\r\n\r\nfunction getParameterByName(name, url) {\r\n\tif (!url) url = window.location.href;\r\n\tname = name.replace(/[\\[\\]]/g, \"\\\\$&\");\r\n\tvar regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\"),\r\n\t\tresults = regex.exec(url);\r\n\tif (!results) return null;\r\n\tif (!results[2]) return '';\r\n\treturn decodeURIComponent(results[2].replace(/\\+/g, \" \"));\r\n}\r\n\r\nfunction buildSocial() {\r\n\tif (typeof socialNetworks !== 'undefined') {\r\n\t\tvar mastodonIcon = \"<svg aria-hidden=\\\"true\\\" focusable=\\\"false\\\" data-prefix=\\\"fab\\\" data-icon=\\\"mastodon\\\" class=\\\"svg-inline--fa fa-mastodon fa-w-14\\\" role=\\\"img\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 448 512\\\"><path fill=\\\"currentColor\\\" d=\\\"M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z\\\"/></svg>\";\r\n\t\tvar mindsIcon = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" standalone=\\\"no\\\"?><svg xmlns:dc=\\\"http://purl.org/dc/elements/1.1/\\\" xmlns:cc=\\\"http://creativecommons.org/ns#\\\" xmlns:rdf=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\" xmlns:svg=\\\"http://www.w3.org/2000/svg\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" id=\\\"svg8\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 56.091668 91.281253\\\" height=\\\"345\\\" width=\\\"212\\\"> <defs id=\\\"defs2\\\"> <filter id=\\\"filter989\\\" style=\\\"color-interpolation-filters:sRGB\\\"> <feColorMatrix result=\\\"fbSourceGraphic\\\" id=\\\"feColorMatrix987\\\" values=\\\"0.21 0.72 0.072 0 0 0.21 0.72 0.072 0 0 0.21 0.72 0.072 0 0 0 0 0 1 0 \\\"/> <feColorMatrix id=\\\"feColorMatrix991\\\" values=\\\"0 0 0 -1 0 0 0 0 -1 0 0 0 0 -1 0 0 0 0 1 0\\\" in=\\\"fbSourceGraphic\\\" result=\\\"fbSourceGraphicAlpha\\\"/> <feColorMatrix result=\\\"fbSourceGraphic\\\" in=\\\"fbSourceGraphic\\\" values=\\\"0.21 0.72 0.072 0 0 0.21 0.72 0.072 0 0 0.21 0.72 0.072 0 0 0 0 0 1 0 \\\" id=\\\"feColorMatrix993\\\"/> <feColorMatrix id=\\\"feColorMatrix995\\\" values=\\\"0 0 0 -1 0 0 0 0 -1 0 0 0 0 -1 0 0 0 0 1 0\\\" in=\\\"fbSourceGraphic\\\" result=\\\"fbSourceGraphicAlpha\\\"/> <feColorMatrix result=\\\"fbSourceGraphic\\\" in=\\\"fbSourceGraphic\\\" values=\\\"0.21 0.72 0.072 0 0 0.21 0.72 0.072 0 0 0.21 0.72 0.072 0 0 0 0 0 1 0 \\\" id=\\\"feColorMatrix997\\\"/> <feColorMatrix id=\\\"feColorMatrix999\\\" values=\\\"0 0 0 -1 0 0 0 0 -1 0 0 0 0 -1 0 0 0 0 1 0\\\" in=\\\"fbSourceGraphic\\\" result=\\\"fbSourceGraphicAlpha\\\"/> <feColorMatrix result=\\\"fbSourceGraphic\\\" in=\\\"fbSourceGraphic\\\" values=\\\"0.21 0.72 0.072 0 0 0.21 0.72 0.072 0 0 0.21 0.72 0.072 0 0 0 0 0 1 0 \\\" id=\\\"feColorMatrix1001\\\"/> <feColorMatrix id=\\\"feColorMatrix1003\\\" values=\\\"0 0 0 -1 0 0 0 0 -1 0 0 0 0 -1 0 0 0 0 1 0\\\" in=\\\"fbSourceGraphic\\\" result=\\\"fbSourceGraphicAlpha\\\"/> <feColorMatrix in=\\\"fbSourceGraphic\\\" values=\\\"0.21 0.72 0.072 0 0 0.21 0.72 0.072 0 0 0.21 0.72 0.072 0 0 0 0 0 1 0 \\\" id=\\\"feColorMatrix1005\\\"/> </filter> </defs> <metadata id=\\\"metadata5\\\"> <rdf:RDF> <cc:Work rdf:about=\\\"\\\"> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource=\\\"http://purl.org/dc/dcmitype/StillImage\\\"/> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <g transform=\\\"translate(0,-205.71873)\\\" id=\\\"layer1\\\"> <g style=\\\"fill:none;fill-rule:evenodd;stroke:none;stroke-width:1;filter:url(#filter989)\\\" transform=\\\"matrix(0.26458333,0,0,0.26458333,29.973508,67.473955)\\\" id=\\\"Page-1\\\"> <g id=\\\"bulb\\\" transform=\\\"matrix(1.0000059,0,0,1,-164.286,495.49995)\\\"> <g id=\\\"Group-5\\\" transform=\\\"translate(107,290)\\\"> <path style=\\\"fill:#656565\\\" d=\\\"M 24.752475,43 22.772277,72 Z\\\" id=\\\"Triangle-3\\\"/> <polygon style=\\\"fill:#656565\\\" id=\\\"polygon915\\\" points=\\\"50,82 0,62 25,41 \\\"/> <polygon style=\\\"fill:#787778\\\" id=\\\"polygon917\\\" points=\\\"25,41 0,0 0,62 \\\"/> <polygon style=\\\"fill:#5c5c5c\\\" id=\\\"polygon919\\\" points=\\\"100,62 75,41 50,82 \\\"/> <polygon style=\\\"fill:#787778\\\" id=\\\"polygon921\\\" points=\\\"100,0 100,62 75,41 \\\"/> <polygon style=\\\"fill:#4a4a4a\\\" id=\\\"polygon923\\\" points=\\\"50,82 0,0 100,0 \\\"/> </g> <g id=\\\"Group\\\" transform=\\\"translate(6,1)\\\"> <polygon style=\\\"fill:#fed12f\\\" id=\\\"polygon926\\\" points=\\\"141,205 111,100 217,144 \\\"/> <polygon style=\\\"fill:#fed12f\\\" id=\\\"polygon928\\\" points=\\\"217,144 191,26 251,88 \\\"/> <polygon style=\\\"fill:#fed12f\\\" id=\\\"polygon930\\\" points=\\\"201,289 101,289 211,257 \\\"/> <polygon style=\\\"fill:#fed12f\\\" id=\\\"polygon932\\\" points=\\\"101,289 91,257 141,205 \\\"/> <polygon style=\\\"fill:#fed12f\\\" id=\\\"polygon934\\\" points=\\\"111,100 51,88 111,26 \\\"/> <polygon style=\\\"fill:#fff3cb\\\" id=\\\"polygon936\\\" points=\\\"217,144 141,205 211,257 \\\"/> <polygon style=\\\"fill:#fff3cb\\\" id=\\\"polygon938\\\" transform=\\\"rotate(140,91.982123,202.37661)\\\" points=\\\"127.84571,161.16396 56.118534,168.85889 118.73141,243.58926 \\\"/> <polygon style=\\\"fill:#ffdd63\\\" id=\\\"polygon940\\\" transform=\\\"rotate(-53,187.64886,90.616899)\\\" points=\\\"162.67918,146.18451 134.02675,35.049287 241.27098,54.405816 \\\"/> <polygon style=\\\"fill:#ffedac\\\" id=\\\"polygon942\\\" transform=\\\"rotate(-53,112.70066,170.14882)\\\" points=\\\"101.89824,213.72364 57.7008,126.82378 167.70052,126.574 \\\"/> <polygon style=\\\"fill:#ffdd63\\\" id=\\\"polygon944\\\" transform=\\\"rotate(-53,148.56988,267.401)\\\" points=\\\"194.44787,311.00043 102.69188,242.40861 193.84987,223.80157 \\\"/> <polygon style=\\\"fill:#ffdd63\\\" id=\\\"polygon946\\\" transform=\\\"rotate(-53,214,200.5)\\\" points=\\\"249.86099,227.31864 167.07165,232.10664 260.92835,168.89336 \\\"/> <polygon style=\\\"fill:#ffdd63\\\" id=\\\"polygon948\\\" transform=\\\"rotate(-53,55.981655,127.40799)\\\" points=\\\"110.98151,154.85305 0.98179637,155.10283 84.456238,99.713142 \\\"/> <polygon style=\\\"fill:#fee382\\\" id=\\\"polygon950\\\" transform=\\\"rotate(-53,254,138)\\\" points=\\\"215.87367,170.48666 226.94103,112.06138 292.12633,105.51334 \\\"/> <polygon style=\\\"fill:#fef1c0\\\" id=\\\"polygon952\\\" transform=\\\"rotate(160,146.32089,50.144248)\\\" points=\\\"171.25385,84.912875 96.078439,57.551263 196.56334,15.375621 \\\"/> </g> </g> </g> </g></svg>\";\r\n\t\tObject.entries(socialNetworks).forEach(function([key, val], index) {\r\n\t\t\tif(key === \"mastodon\") {\r\n\t\t\t\t$(\"#social\").append(`<li><a href=\"${val}\" target=\"_blank\" title=\"${key}\">${mastodonIcon}</a></li>`);\r\n\t\t\t} else if(key === \"minds\") {\r\n\t\t\t\t$(\"#social\").append(`<li><a href=\"${val}\" target=\"_blank\" title=\"${key}\">${mindsIcon}</a></li>`);\r\n\t\t\t} else {\r\n\t\t\t\t$(\"#social\").append(`<li><a href=\"${val}\" target=\"_blank\" title=\"${key}\"><i class=\"fab fa-${key}\" aria-hidden=\"true\"></i></a></li>`);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n}\r\n\r\n\r\nfunction languageChecker() {\r\n\tvar symbol = document.getElementById('language-symbol');\r\n\r\n\tsymbol.textContent = window.location.href.startsWith(`${siteUrl}/en/`) ? 'en' : 'fr';\r\n\r\n\t$(\"#language-symbol\").on(\"click\", function (e) {\r\n\t\tif (symbol.textContent == 'en'){\r\n\t\t\twindow.location = `${siteUrl}/prologue`;\r\n\t\t}\r\n\t\telse {\r\n\t\t\twindow.location = `${siteUrl}/en`;\r\n\t\t}\r\n\t})\r\n\treturn symbol;\r\n}\r\n\r\nfunction initLanguageSwitcher() {\r\n\r\n\tfunction setInitLanguage(language) {\r\n\t\tvar current = localStorage.getItem(\"zvikov-lang\") || 'fr';\r\n\t\tif (current !== language) {\r\n\t\t\tlocalStorage.setItem(\"zvikov-lang\", language);\r\n\t\t\tcurrent = language;\r\n\t\t}\r\n\t\treturn current;\r\n\t}\r\n\r\n\t$(\"#language-switcher-en\").on(\"click\", function (e) {\r\n\t\tlocalStorage.setItem(\"zvikov-lang\", 'en');\r\n\t\twindow.location = `${siteUrl}/en`;\r\n\t})\r\n\r\n\t$(\"#language-switcher-fr\").on(\"click\", function (e) {\r\n\t\tlocalStorage.setItem(\"zvikov-lang\", 'fr');\r\n\t\twindow.location = `${siteUrl}/prologue`;\r\n\t});\r\n\r\n\treturn setInitLanguage(\r\n\t\twindow.location.href.startsWith(`${siteUrl}/en/`) ? 'en' : 'fr');\r\n}\r\n\r\nfunction initColorSwitcher() {\r\n\r\n\tvar colors = [\"dark\", \"light\"];\r\n\tvar saved_color = localStorage.getItem(\"zvikov-color\");\r\n\r\n\tif(colors.includes(saved_color)) {\r\n\t\t$(\"body\").addClass(saved_color);\r\n\t\t$(\"#color-switcher\").attr(\"data-color\", (saved_color) === \"light\" ? \"dark\" : \"light\");\r\n\t} else {\r\n\t\t$(\"body\").addClass(\"light\");\r\n\t\t$(\"#color-switcher\").attr(\"data-color\", \"dark\");\r\n\t}\r\n\r\n\t$(\"#color-switcher\").on(\"click\", function (e) {\r\n\r\n\t\tvar setColor = $('#color-switcher').attr(\"data-color\");\r\n\t\tvar otherColor = (setColor) === \"light\" ? \"dark\" : \"light\";\r\n\r\n\t\t$(\"body\").addClass(setColor);\r\n\t\t$(\"body\").removeClass(otherColor);\r\n\r\n\t\t$(\"#color-switcher\").attr(\"data-color\", otherColor);\r\n\t\tlocalStorage.setItem(\"zvikov-color\", setColor);\r\n\r\n\t});\r\n\r\n}\r\n\r\n// function initLightbox() {\r\n//\r\n// \t$(\".kg-gallery-image:not(.with-carousel) > img, .kg-gallery-image:not(.with-carousel) span > img\").wrap(`<a data-gallery='collection-gallery' data-toggle='lightbox' class='lb-item'></a>`);\r\n//\r\n// \t$(\".kg-gallery-image\").addClass(\"with-carousel\");\r\n//\r\n// \t$(\".kg-gallery-image .lb-item\").each(function(e, t) {\r\n// \t\t$(this).attr(\"href\", $(this).children(\"img\").attr(\"src\"))\r\n// \t});\r\n//\r\n// }\r\n\r\n// Give the parameter a variable name\r\n\r\nvar action = getParameterByName('action');\r\nvar stripe = getParameterByName('stripe');\r\nvar success = getParameterByName('success');\r\n\r\nvar language = initLanguageSwitcher();\r\nvar language_symbol = languageChecker();\r\n\r\ninitColorSwitcher();\r\n\r\n$('#donorwall-iframe').on('load', function() {\r\n\tsetTimeout(function () {\r\n\t\t$('.swiper-wrapper').height($('.swiper-slide-active').height());\r\n\t}, 50);\r\n});\r\n\r\njQuery(document).ready(function($) {\r\n\r\n\t$(\"#contact-trigger\").click(function() {\r\n\t\t$('#menu').modal('hide');\r\n\t})\r\n\r\n\tbuildSocial();\r\n\r\n\t// $(document).on(\"click\", '[data-toggle=\"lightbox\"]', function(e) {\r\n\t// \te.preventDefault();\r\n\t// \t$(this).ekkoLightbox();\r\n\t// });\r\n\r\n\tvar config = {\r\n\t\t'content-api-host': 'https://bastienrivath.ghost.io',\r\n\t\t'content-api-key': '18eec1a6fdcf759bc1251c9d81'\r\n\t};\r\n\r\n\tif (action == 'subscribe') {\r\n\t\t$('body').addClass(\"subscribe-success\");\r\n\t}\r\n\r\n\tif (action == 'signup') {\r\n\t\twindow.location = `${siteUrl}/signup/?action=checkout`;\r\n\t}\r\n\r\n\tif (action == 'checkout') {\r\n\t\t$('body').addClass(\"signup-success\");\r\n\t}\r\n\r\n\t// Success === null is here for backwards compatibility, can be removed shortly\r\n\tif (action == 'signin' && (success === null || success === 'true')) {\r\n\t\t$('body').addClass(\"signin-success\");\r\n\t}\r\n\r\n\tif (action == 'signin' && success === 'false') {\r\n\t\t$('body').addClass(\"signin-failure\");\r\n\t}\r\n\r\n\tif (stripe == 'success') {\r\n\t\t$('body').addClass(\"checkout-success\");\r\n\t}\r\n\r\n\tif (stripe == 'billing-update-success') {\r\n\t\t$('body').addClass(\"billing-success\");\r\n\t}\r\n\r\n\tif (stripe == 'billing-update-cancel') {\r\n\t\t$('body').addClass(\"billing-cancel\");\r\n\t}\r\n\r\n\t$('.notification-close').click(function () {\r\n\t\t$(this).parent().addClass('closed');\r\n\t\tvar uri = window.location.toString();\r\n\t\tif (uri.indexOf(\"?\") > 0) {\r\n\t\t\tvar clean_uri = uri.substring(0, uri.indexOf(\"?\"));\r\n\t\t\twindow.history.replaceState({}, document.title, clean_uri);\r\n\t\t}\r\n\t});\r\n\r\n\t// Account navigation menu\r\n\r\n\t$('.account-menu-avatar').click(function(event) {\r\n\t\t$(this).toggleClass('active');\r\n\t\tevent.stopPropagation();\r\n\t});\r\n\r\n\t$('.lang-menu').click(function(event) {\r\n\t\t$(this).toggleClass('active');\r\n\t\tevent.stopPropagation();\r\n\t});\r\n\r\n\t$('.account-menu-dropdown').click(function(event) {\r\n\t\tevent.stopPropagation();\r\n\t});\r\n\r\n\t$('body').click(function () {\r\n\t\t$('.account-menu-avatar').removeClass('active');\r\n\t\t$('.lang-menu').removeClass('active');\r\n\t});\r\n\r\n\t// Reading Progress.\r\n\r\n\tvar progressBar = document.querySelector('#reading-progress');\r\n\tvar lastScrollY = window.scrollY;\r\n\tvar lastWindowHeight = window.innerHeight;\r\n\tvar ticking = false;\r\n\r\n\tfunction onScroll() {\r\n\t\tlastScrollY = window.scrollY;\r\n\t\trequestTick();\r\n\t}\r\n\r\n\tfunction onResize() {\r\n\t\tlastWindowHeight = window.innerHeight;\r\n\t\trequestTick();\r\n\t}\r\n\r\n\tfunction requestTick() {\r\n\t\tif (!ticking) requestAnimationFrame(update);\r\n\t\tticking = true;\r\n\t}\r\n\r\n\tfunction update() {\r\n\t\tif(progressBar){\r\n\t\t\tvar triggerOffset = progressBar.offsetHeight + $(\"#main-header\").height() + $('.swiper-slide.swiper-slide-active .post-cover').height();\r\n\t\t\tvar progressMax = $('.swiper-slide.swiper-slide-active .post-content').height() - lastWindowHeight - window.innerHeight;\r\n\t\t\t$('#reading-progress').css(\"width\", (lastScrollY >= triggerOffset) ? ((lastScrollY - triggerOffset) / (progressMax + (triggerOffset * 2))) * 100 + '%' : 0);\r\n\t\t\tticking = false;\r\n\t\t}\r\n\t}\r\n\r\n\twindow.addEventListener('scroll', onScroll, {passive: true});\r\n\twindow.addEventListener('resize', onResize, false);\r\n\r\n\tupdate();\r\n\r\n\t// Initializing Ghost Content API.\r\n\r\n\tvar ghostAPI = new GhostContentAPI({\r\n        url: config['content-api-host'],\r\n        key: config['content-api-key'],\r\n        version: 'v3'\r\n    });\r\n\r\n    var w = Math.max(document.documentElement.clientWidth, window.innerWidth || 0),\r\n        h = Math.max(document.documentElement.clientHeight, window.innerHeight || 0),\r\n        activeSlide,\r\n        currentPageNext = 1,\r\n        currentPagePrev = 1,\r\n        pathname = window.location.pathname,\r\n        // $result = $('#content .loop .swiper-wrapper'),\r\n        nextPage,\r\n        prevPage,\r\n        countAllPosts,\r\n        filter = \"\",\r\n        // firstPostId = $('.article-container .read-later').attr('data-id'),\r\n        firstPostIndex = 0,\r\n        allPosts,\r\n        readLaterPosts = [],\r\n        swiperPosts,\r\n        checkHistoryOnChange,\r\n        noBookmarksMessage = $('.no-bookmarks').html(),\r\n        monthNames = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\r\n\r\n\t$('#content .loop .swiper-slide').addClass('first');\r\n\r\n    imageInDiv();\r\n    readingTime($('#content .loop .swiper-slide'));\r\n    // initLightbox();\r\n\r\n\tif (typeof Cookies.get('zvikov-read-later') !== \"undefined\") {\r\n\t\treadLaterPosts = JSON.parse(Cookies.get('zvikov-read-later'));\r\n\t}\r\n\r\n\treadLaterPosts = readLater($('#content .loop .swiper-slide'), readLaterPosts);\r\n\r\n\t$(window).on('load', function(event) {\r\n\r\n\t\t// Initialize Posts Swiper slider\r\n\t\tswiperPosts = new Swiper('#content .loop .swiper-container', {\r\n\t\t\tslidesPerView: 1,\r\n\t\t\tspaceBetween: 30,\r\n\t\t\tcenteredSlides: true,\r\n\t\t\tautoHeight: true,\r\n\t\t\tsimulateTouch: false,\r\n\t\t\tallowTouchMove: false,\r\n\t\t\tnavigation: {\r\n\t\t\t\tnextEl: '#content .loop .next a',\r\n\t\t\t\tprevEl: '#content .loop .prev a',\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tcheckHistoryOnChange = 0;\r\n\r\n\t\t// On slide change add new post to history\r\n\t\tswiperPosts.on('slideChangeTransitionEnd', function(event) {\r\n\t\t\t$('.swiper-wrapper').height($('.swiper-slide-active').height());\r\n\r\n\t\t\tif (checkHistoryOnChange != 1) {\r\n\t\t\t\tvar value = $('.swiper-slide-active').attr('data-history');\r\n\t\t\t\tconsole.log(window.location, 'value:', value);\r\n\t\t\t\tvar url = window.location.origin + '/' + value + '/';\r\n\t\t\t\thistory.pushState({ value: value }, null, url);\r\n\t\t\t};\r\n\r\n\t\t\tcheckHistoryOnChange = 0;\r\n\t\t\tupdate();\r\n\t\t\t// initLightbox();\r\n\r\n\t\t\t$(\".swiper-slide-active .lb-item\").attr(\"data-gallery\", $('.swiper-slide-active').attr('data-history'));\r\n\r\n\t\t});\r\n\r\n\t\tpathname = pathname.replace(/#(.*)$/g, '').replace('/\\//g', '/');\r\n\r\n\t\t// If body has class paged load next/prev posts based on the current page number\r\n\t\tif ($('body').hasClass('paged')) {\r\n\t\t\tcurrentPageNext = parseInt(pathname.replace(/[^0-9]/gi, ''));\r\n\t\t\tcurrentPagePrev = parseInt(pathname.replace(/[^0-9]/gi, ''));\r\n\t\t};\r\n\r\n\t\tif (typeof maxPages === 'undefined' || maxPages === null) {\r\n\t\t\tmaxPages = 0;\r\n\t\t};\r\n\r\n\t\t// If body has class tag-template filter by current tag\r\n\t\tif ($('body').hasClass('tag-template')) {\r\n\t\t\tfilter = \"tag:\" + $('.tag-title').attr('data-tag');\r\n\t\t};\r\n\r\n\t\t// If body has class author-template filter by current author\r\n\t\tif ($('body').hasClass('author-template')) {\r\n\t\t\tfilter = \"author:\" + $('.author').attr('data-author');\r\n\t\t};\r\n\r\n\t\t// Always add language filter\\\r\n\t\tconsole.log(language);\r\n\t\tif (language == 'en') {\r\n\t\t\tfilter = (filter.length > 0 ? filter + '+' : '') + 'tag:hash-en';\r\n\t\t} else {\r\n\t\t\tfilter = (filter.length > 0 ? filter + '+' : '') + 'tag:-hash-en';\r\n\t\t}\r\n\r\n\t\t// Fetch posts\r\n\t\tghostAPI.posts\r\n\t\t\t.browse({\r\n\t\t\t\tlimit: 'all',\r\n\t\t\t\tfilter: filter,\r\n\t\t\t\t// include: 'tags',\r\n\t\t\t\torder: 'published_at ASC'\r\n\t\t\t})\r\n\t\t\t.then((data) => {\r\n\r\n\t\t\t\tallPosts = data;\r\n\t\t\t\tcountAllPosts = data.meta.pagination.total; // data.length;\r\n\t\t\t\tmaxPages = countAllPosts;\r\n\t\t\t\tfirstPostIndex = 0;\r\n\r\n\t\t\t\tif (!$('body').hasClass('post-template')) {\r\n\t\t\t\t\t// Create pagination number\r\n\t\t\t\t\t$('.pagination-number').append('<b>'+ (firstPostIndex + 1) +'</b>/' + countAllPosts);\r\n\t\t\t\t}\r\n\t\t\t\t/*\r\n\t\t\t\t$.each(data, function(index, val) {\r\n\t\t\t\t\tvar currentId = $('.swiper-slide-active .article-container').attr('data-id');\r\n\t\t\t\t\tconsole.log('firstPostId', firstPostId);\r\n\t\t\t\t\tconsole.log('val', val)\r\n\t\t\t\t\tif (val.comment_id == firstPostId) {\r\n\t\t\t\t\t\tfirstPostIndex = index + 1;\r\n\t\t\t\t\t\t$('.pagination-number').append('<b>'+ firstPostIndex +'</b>/' + countAllPosts);\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\t\t*/\r\n\r\n\t\t\t\tif ($('body').hasClass('post-template')) {\r\n\t\t\t\t\t$.each(allPosts, function(index, val) {\r\n\t\t\t\t\t\tif (val.comment_id == $('.loop .swiper-slide:last-child .article-container .read-later').attr('data-id')) {\r\n\t\t\t\t\t\t\t$('.pagination-number').append('<b>'+ (index + 1) +'</b>/' + countAllPosts);\r\n\t\t\t\t\t\t\tcurrentPageNext = index;\r\n\t\t\t\t\t\t\tcurrentPagePrev = index;\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if ($('#homepage').length || $('body').hasClass('subscribe') || $('body').hasClass('home-template')) {\r\n\t\t\t\t\t$('a.btn.btn-lg.btn-primary').attr('href', allPosts[0].slug);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t} else if($('body').hasClass('subscribe') || $('body').hasClass('page-template') || $('.error-content').length){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Load new posts\r\n\t\t\t\tif (firstPostIndex == 1) {\r\n\t\t\t\t\tfor (var i = 0; i <= 1; i++) {\r\n\t\t\t\t\t\tloadNextPost(maxPages, nextPage, allPosts, swiperPosts);\r\n\t\t\t\t\t\tloadPrevPost(maxPages, prevPage, allPosts, swiperPosts);\r\n\t\t\t\t\t};\r\n\t\t\t\t}else{\r\n\t\t\t\t\tloadNextPost(maxPages, nextPage, allPosts, swiperPosts);\r\n\t\t\t\t\tloadPrevPost(maxPages, prevPage, allPosts, swiperPosts);\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// On slide change load new posts\r\n\t\t\t\tswiperPosts.on('slideChange', function(event) {\r\n\t\t\t\t\t$('.loop .swiper-slide.first').removeClass('first').addClass('loaded');\r\n\t\t\t\t\tactiveSlide = swiperPosts.activeIndex;\r\n\t\t\t\t\tif (activeSlide == 1) {\r\n\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\tloadPrevPost(maxPages, prevPage, allPosts, swiperPosts);\r\n\t\t\t\t\t\t}, 300);\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tif (activeSlide >= (swiperPosts.slides.length - 2)) {\r\n\t\t\t\t\t\tloadNextPost( maxPages, nextPage, allPosts, swiperPosts);\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t});\r\n\r\n\t\t})\r\n\t\t.catch((err) => {\r\n\t\t\tconsole.error(err);\r\n\t\t});\r\n\r\n\t});\r\n\r\n\t// Make arrows sticky\r\n    if (w < 768){\r\n        $(\".next, .prev\").stick_in_parent({\r\n\t\t\toffset_top: 100,\r\n\t\t}).on(\"sticky_kit:bottom\", function(e) {\r\n\t    \t$('.next').addClass('bottom');\r\n\t  \t}).on(\"sticky_kit:unbottom\", function(e) {\r\n\t    \t$('.next').removeClass('bottom');\r\n\t  \t});\r\n    }else{\r\n        $(\".next, .prev\").stick_in_parent({\r\n\t\t\toffset_top: 225,\r\n\t\t});\r\n    }\r\n\r\n    var ghostSearch = new GhostSearch({\r\n        host: config['content-api-host'],\r\n        key: config['content-api-key'],\r\n        input: '#search-field',\r\n        results: '#results',\r\n        api: {\r\n            parameters: {\r\n                fields: ['title', 'slug', 'published_at', 'primary_tag', 'comment_id'],\r\n                include: 'tags',\r\n            },\r\n        },\r\n        on: {\r\n            afterDisplay: function(results) {\r\n\r\n                $('#results').empty();\r\n\r\n                var tags = [];\r\n                $.each(results, function(index, val) {\r\n                    if (val.obj.primary_tag) {\r\n                        if ($.inArray(val.obj.primary_tag.name, tags) === -1) {\r\n                            tags.push(val.obj.primary_tag.name);\r\n                        };\r\n                    }else{\r\n                        if ($.inArray('Other', tags) === -1) {\r\n                            tags.push('Other');\r\n                        };\r\n                    };\r\n                });\r\n\r\n                tags.sort();\r\n\r\n                $.each(tags, function(index, val) {\r\n                    var tag = val;\r\n                    if (val == 'Other') {\r\n                        tag = $('#results').attr('data-other');\r\n                    };\r\n                    $('#results').append('<h5>'+ tag +'</h5><ul data-tag=\"'+ val +'\" class=\"list-box\"></ul>');\r\n                });\r\n\r\n                $.each(results, function(index, val) {\r\n\r\n                    var dateSplit = val.obj.published_at.split('T');\r\n                    dateSplit = dateSplit[0].split('-');\r\n                    var month = monthNames[dateSplit[1]-1];\r\n                    var date = moment(dateSplit[2]+'-'+month+'-'+dateSplit[1], \"DD-MM-YYYY\").format('DD MMM YYYY');\r\n                    var url = `/${val.obj.slug}`;\r\n\r\n                    var appendTo = val.obj.primary_tag ?\r\n\t\t\t\t\t\t`#results ul[data-tag=\"${val.obj.primary_tag.name}\"]` :\r\n\t\t\t\t\t\t`#results ul[data-tag=\"Other\"]`;\r\n\r\n\t\t\t\t\t$(appendTo).append(`\r\n\t\t\t\t\t\t<li>\r\n\t\t\t\t\t\t\t<time>${date}</time>\r\n\t\t\t\t\t\t\t<a href=\"#\" class=\"read-later\" data-id=\"${val.obj.comment_id}\"></a>\r\n\t\t\t\t\t\t\t<a href=\"${url}\">${val.obj.title}</a>\r\n\t\t\t\t\t\t</li>\r\n\t\t\t\t\t`);\r\n\r\n                });\r\n\r\n                readLaterPosts = readLater($('#results'), readLaterPosts);\r\n\r\n            },\r\n        }\r\n    })\r\n\r\n\t$('#search').on('shown.bs.modal', function (e) {\r\n\t\t$('#search-field').focus();\r\n\t});\r\n\r\n\t// Execute on resize\r\n    $(window).on('resize', function(event) {\r\n        w = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\r\n        h = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\r\n\r\n        if (w < 768){\r\n        \t$(\".next, .prev\").trigger(\"sticky_kit:detach\");\r\n            $(\".next, .prev\").stick_in_parent({\r\n\t\t\t\toffset_top: 100,\r\n\t\t\t}).on(\"sticky_kit:bottom\", function(e) {\r\n\t\t    \t$('.next').addClass('bottom');\r\n\t\t  \t}).on(\"sticky_kit:unbottom\", function(e) {\r\n\t\t    \t$('.next').removeClass('bottom');\r\n\t\t  \t});\r\n        }else{\r\n        \t$(\".next, .prev\").trigger(\"sticky_kit:detach\");\r\n            $(\".next, .prev\").stick_in_parent({\r\n\t\t\t\toffset_top: 225,\r\n\t\t\t});\r\n        }\r\n\r\n        setTimeout(function() {\r\n\t\t\t$('.swiper-wrapper').height($('.swiper-slide-active').height());\r\n\t\t}, 300);\r\n\r\n    });\r\n\r\n    // On back/forward click change slide\r\n\tif (window.history && window.history.pushState) {\r\n\t\t$(window).on('popstate', function() {\r\n\t\t\tcheckHistoryOnChange = 1;\r\n\t\t\tvar check = 0;\r\n\t\t\t$.each(swiperPosts.slides, function(index, val) {\r\n\t\t\t\tif (window.history.state != null) {\r\n\t\t\t\t\tif (window.history.state.value == val.dataset.history) {\r\n\t\t\t\t\t\tswiperPosts.slideTo(index);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (window.history.state.value == '') {\r\n\t\t\t\t\t\tcheck++;\r\n\t\t\t\t\t};\r\n\t\t\t\t}else{\r\n\t\t\t\t\tcheck++;\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tif (check > 0) {\r\n\t\t\t\tswiperPosts.slideTo(0);\r\n\t\t\t};\r\n\t\t});\r\n\t}\r\n\r\n    // Initialize Highlight.js\r\n    $('pre code').each(function(i, block) {\r\n        hljs.highlightBlock(block);\r\n    });\r\n\r\n\t// Wrap image in a span element\r\n    function imageInDiv(){\r\n    \t$('.swiper-slide:not(.swiper-slide-active) .article-container .post-content img').each(function(index, el) {\r\n    \t\tvar parent = $(this).parent();\r\n    \t\tif (!parent.hasClass('img-holder') && !parent.parent().hasClass('img-holder')) {\r\n    \t\t\tparent.addClass('img-holder');\r\n    \t\t\tparent.prepend('<span></span>');\r\n    \t\t\t$(this).prependTo(parent.find('span'));\r\n    \t\t};\r\n    \t});\r\n    }\r\n\r\n\tfunction prettyDate(date) {\r\n\t\tvar d = new Date(date);\r\n\t\tvar monthNames = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\r\n\t\t\treturn d.getDate() + ' ' + monthNames[d.getMonth()] + ' ' + d.getFullYear();\r\n\t};\r\n\r\n\tfunction removeValue(arr) {\r\n\t    var what, a = arguments, L = a.length, ax;\r\n\t    while (L > 1 && arr.length) {\r\n\t        what = a[--L];\r\n\t        while ((ax= arr.indexOf(what)) !== -1) {\r\n\t            arr.splice(ax, 1);\r\n\t        }\r\n\t    }\r\n\t    return arr;\r\n\t}\r\n\r\n\tfunction readLater(content, readLaterPosts){\r\n\r\n\t\tif (typeof Cookies.get('zvikov-read-later') !== \"undefined\") {\r\n\t\t\t$.each(readLaterPosts, function(index, val) {\r\n\t\t\t\t$('.read-later[data-id=\"'+ val +'\"]').addClass('active');\r\n\t\t\t});\r\n\t\t\tbookmarks(readLaterPosts);\r\n\t\t}\r\n\r\n\t\t$(content).find('.read-later').each(function(index, el) {\r\n\t\t\t$(this).on('click', function(event) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tvar id = $(this).attr('data-id');\r\n\t\t\t\tif ($(this).hasClass('active')) {\r\n\t\t\t\t\tremoveValue(readLaterPosts, id);\r\n\t\t\t\t}else{\r\n\t\t\t\t\treadLaterPosts.push(id);\r\n\t\t\t\t};\r\n\t\t\t\t$('.read-later[data-id=\"'+ id +'\"]').each(function(index, el) {\r\n\t\t\t\t\t$(this).toggleClass('active');\r\n\t\t\t\t});\r\n\t\t\t\t$('header .btns a .counter').addClass('shake');\r\n\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t$('header .btns a .counter').removeClass('shake');\r\n\t\t\t\t}, 300);\r\n\t\t\t\tCookies.set('zvikov-read-later', readLaterPosts, { expires: 365 });\r\n\t\t\t\tbookmarks(readLaterPosts);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\treturn readLaterPosts;\r\n\r\n\t}\r\n\r\n\tfunction bookmarks(readLaterPosts){\r\n\r\n\t\t$('.bookmark-container').empty();\r\n\t\tif (readLaterPosts.length) {\r\n\r\n\t\t\tvar filter = readLaterPosts.toString();\r\n\t\t\tfilter = \"comment_id:[\"+filter+\"]\";\r\n\r\n            ghostAPI.posts\r\n                .browse({limit: 'all', filter: filter, include: 'tags'})\r\n                .then((results) => {\r\n\r\n                    $('.bookmark-container').empty();\r\n\r\n                    var tags = [];\r\n                    $.each(results, function(index, val) {\r\n                        if (val.primary_tag) {\r\n                            if ($.inArray(val.primary_tag.name, tags) === -1) {\r\n                                tags.push(val.primary_tag.name);\r\n                            };\r\n                        }else{\r\n                            if ($.inArray('Other', tags) === -1) {\r\n                                tags.push('Other');\r\n                            };\r\n                        };\r\n                    });\r\n\r\n                    tags.sort();\r\n\r\n                    $.each(tags, function(index, val) {\r\n                        var tag = val;\r\n                        if (val == 'Other') {\r\n                            tag = $('.bookmark-container').attr('data-other');\r\n                        };\r\n                        $('.bookmark-container').append('<h5>'+ tag +'</h5><ul data-tag=\"'+ val +'\" class=\"list-box\"></ul>');\r\n\t\t\t\t\t});\r\n\r\n                    $.each(results, function(index, val) {\r\n                        var dateSplit = val.published_at.split('T');\r\n                        dateSplit = dateSplit[0].split('-');\r\n                        var month = monthNames[dateSplit[1]-1];\r\n                        var date = moment(dateSplit[2]+'-'+month+'-'+dateSplit[1], \"DD-MM-YYYY\").format('DD MMM YYYY');\r\n\t\t\t\t\t\tvar url = `/${val.slug}`;\r\n\r\n\t\t\t\t\t\tvar appendTo = val.primary_tag ?\r\n\t\t\t\t\t\t\t`.bookmark-container ul[data-tag=\"${val.primary_tag.name}\"]` :\r\n\t\t\t\t\t\t\t`.bookmark-container ul[data-tag=\"Other\"]`;\r\n\r\n\t\t\t\t\t\t$(appendTo).append(`\r\n\t\t\t\t\t\t\t<li>\r\n\t\t\t\t\t\t\t\t<time>${date}</time>\r\n\t\t\t\t\t\t\t\t<a href=\"#\" class=\"read-later active\" data-id=\"${val.comment_id}\"></a>\r\n\t\t\t\t\t\t\t\t<a href=\"${url}\">${val.title}</a>\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t`);\r\n\r\n                    });\r\n\r\n                    $('.bookmark-container').find('.read-later').each(function(index, el) {\r\n                        $(this).on('click', function(event) {\r\n                            event.preventDefault();\r\n                            var id = $(this).attr('data-id');\r\n                            if ($(this).hasClass('active')) {\r\n                                removeValue(readLaterPosts, id);\r\n                            }else{\r\n                                readLaterPosts.push(id);\r\n                            };\r\n                            $('.read-later[data-id=\"'+ id +'\"]').each(function(index, el) {\r\n                                $(this).toggleClass('active');\r\n                            });\r\n                            Cookies.set('zvikov-read-later', readLaterPosts, { expires: 365 });\r\n                            bookmarks(readLaterPosts);\r\n                        });\r\n                    });\r\n\r\n                    if (results) {\r\n                        $('header .counter').removeClass('hidden').text(results.length);\r\n                    }else{\r\n                        $('header .counter').addClass('hidden');\r\n                        $('.bookmark-container').append('<p class=\"no-bookmarks\"></p>');\r\n                        $('.no-bookmarks').html(noBookmarksMessage)\r\n                    };\r\n\t\t\t})\r\n\t\t\t.catch((err) => {\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$('header .counter').addClass('hidden');\r\n            $('.bookmark-container').append('<p class=\"no-bookmarks\"></p>');\r\n            $('.no-bookmarks').html(noBookmarksMessage)\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tfunction loadNextPost(maxPages, nextPage, allPosts, swiperPosts){\r\n\r\n\t\tif (currentPageNext == maxPages) return;\r\n\r\n\t\tcurrentPageNext++;\r\n\r\n\t\tif ($('body').hasClass('paged')) {\r\n\t\t\tconsole.log('hasClass:paged', pathname);\r\n\t\t\tpathname = '/';\r\n\t\t};\r\n\r\n\t\tnextPage = pathname + 'page/' + currentPageNext + '/';\r\n\r\n\t\tif ($('body').hasClass('post-template')) {\r\n\t\t\tif (currentPageNext > (allPosts.length - 1)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tnextPage = '/' + allPosts[currentPageNext].slug;\r\n\t\t}\r\n\r\n\t\t$.get(nextPage, function (content) {\r\n\r\n\t\t\tvar postIndex = parseInt(nextPage.replace(/[^0-9]/gi, ''));\r\n\t\t\tvar content = $(content);\r\n\r\n\t\t\tvar currentIndex = parseInt($('.loop .swiper-slide:last-child .pagination-number:first-child b').text()) + 1;\r\n\t\t\tcontent.find('.pagination-number').append('<b>'+ currentIndex +'</b>/' + countAllPosts);\r\n\t\t\treadingTime(content.find('#content .loop .swiper-slide'));\r\n\r\n\t\t\tcontent.find('#content .loop .swiper-slide').addClass('loaded').removeClass('first');\r\n\t\t\tswiperPosts.appendSlide(content.find('#content .loop .swiper-slide'));\r\n\t\t\timageInDiv();\r\n\r\n\t\t\tif (!$('.loop .next a, .loop .prev a').hasClass('active')) $('.loop .next a, .loop .prev a').addClass('active');\r\n\r\n\t\t\t$('pre:not(.hljs)').each(function(i, block) {\r\n\t\t\t\thljs.highlightBlock(block);\r\n\t\t\t});\r\n\r\n\t\t\treadLaterPosts = readLater($('.loop .swiper-slide:last-child'), readLaterPosts);\r\n\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tfunction loadPrevPost(maxPages, prevPage, allPosts, swiperPosts){\r\n\t\tif (currentPagePrev < 1) {\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tcurrentPagePrev--;\r\n\r\n\t\tif ($('body').hasClass('paged')) {\r\n\t\t\tpathname = '/';\r\n\t\t}else if($('body').hasClass('home-template') || $('body').hasClass('author-template') || $('body').hasClass('tag-template')){\r\n\t\t\tif (currentPagePrev == 0) {\r\n\t\t\t\treturn;\r\n\t\t\t};\r\n\t\t};\r\n\t\tprevPage = pathname + 'page/' + currentPagePrev + '/';\r\n\r\n\t\tif ($('body').hasClass('post-template')) {\r\n\t\t\tprevPage = '/' + allPosts[currentPagePrev].slug;\r\n\t\t};\r\n\t\t$.get(prevPage, function (content) {\r\n\t\t\tvar postIndex = parseInt(prevPage.replace(/[^0-9]/gi, ''));\r\n\t\t\tvar content = $(content);\r\n\r\n\t\t\tvar currentIndex = parseInt($('.loop .swiper-slide:first-child .pagination-number:first-child b').text()) - 1;\r\n\t\t\tcontent.find('.pagination-number').append('<b>'+ currentIndex +'</b>/' + countAllPosts);\r\n\t\t\treadingTime(content.find('#content .loop .swiper-slide'));\r\n\r\n\t\t\tcontent.find('#content .loop .swiper-slide').addClass('loaded').removeClass('first');\r\n\t\t\tswiperPosts.prependSlide($(content).find('#content .loop .swiper-slide'));\r\n\t\t\timageInDiv();\r\n\r\n\t\t\tif (!$('.loop .next a, .loop .prev a').hasClass('active')) {\r\n\t\t\t\t$('.loop .next a, .loop .prev a').addClass('active');\r\n\t\t\t};\r\n\r\n\t\t\t$('pre:not(.hljs)').each(function(i, block) {\r\n\t\t\t\thljs.highlightBlock(block);\r\n\t\t\t});\r\n\r\n\t\t\treadLaterPosts = readLater($('.loop .swiper-slide:first-child'), readLaterPosts);\r\n\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tfunction readingTime(content){\r\n\t\tvar readingTime = content.find('.reading-time');\r\n\t\tif (readingTime.length) {\r\n\t\t\tif (readingTime.text() == '< 1 min read') {\r\n\t\t\t\treadingTime.text('<1m');\r\n\t\t\t}else{\r\n\t\t\t\treadingTime.text(parseInt(readingTime.text()) + 'm');\r\n\t\t\t};\r\n\t\t\treadingTime.removeClass('d-none');\r\n\t\t};\r\n\t}\r\n\r\n});\r\n"],"file":"main.js"}